<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="description" content="Calcite Maps Demo - ArcGIS">
  <link rel="icon" href="https://www.esri.com/favicon.ico">
  <title>.:: INGEMMET - Patrimonio Geológico ::.</title>

  <!-- Calcite Maps Bootstrap -->
  <link rel="stylesheet" href="https://geocatmin.ingemmet.gob.pe/_calcite/dist/css/calcite-maps-bootstrap.min-v0.10.css">

  <!-- Calcite Maps -->
  <link rel="stylesheet" href="https://geocatmin.ingemmet.gob.pe/_calcite/dist/css/calcite-maps-arcgis-4.x.min-v0.10.css">
  <!--link rel="stylesheet" href="../../dist/css/calcite-maps.min-v0.10.css"--> <!-- works -->

  <!-- ArcGIS JS 4 -->
  <link rel="stylesheet" href="https://js.arcgis.com/4.10/esri/css/main.css">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
  </style>
  
</head>

<body class="calcite-maps calcite-nav-top">

  <!-- Navbar -->

  <nav class="navbar calcite-navbar navbar-fixed-top calcite-text-light calcite-bg-dark calcite-bgcolor-dark-blue">
    <!-- Menu -->
    <div class="dropdown calcite-dropdown calcite-bg-light calcite-text-dark" role="presentation">
      <a class="dropdown-toggle" role="menubutton" aria-haspopup="true" aria-expanded="false" tabindex="0">
        <div class="calcite-dropdown-toggle">
          <span class="sr-only">Toggle dropdown menu</span>
          <span></span>
          <span></span>
          <span></span>
          <span></span>
        </div>
      </a>
      <ul class="dropdown-menu calcite-menu-drawer">
        <li><a class="active hidden-md hidden-lg"          href="#mapTab"      aria-controls="mapTab"      role="tab" data-toggle="tab"> Map</a></li>
        <li><a class="  hidden-md hidden-lg"   href="#sceneTab"    aria-controls="sceneTab"    role="tab" data-toggle="tab"> Scene</a></li>
        <li><a role="menuitem" tabindex="0" data-target="#panelInfo" aria-haspopup="true"><span class="glyphicon glyphicon-info-sign"></span> Info</a></li>
        
        
        <li><a role="menuitem" tabindex="1" data-target="#panelBasemaps" aria-haspopup="true"><span class="glyphicon glyphicon-th-large"></span> Mapas Base</a></li>

        <li><a role="menuitem" tabindex="2" data-target="#panelBookmarks" aria-haspopup="true"><span class="glyphicon glyphicon-book"></span> Sitios de Interes</a></li>
        <li><a role="menuitem" tabindex="3" data-target="#panelCoordinateConversion" aria-haspopup="true"><span class="glyphicon glyphicon-globe"></span> Converión de Coordenadas</a></li>
        <li><a role="menuitem" tabindex="4" data-target="#panelLayerList" aria-haspopup="true"><span class="glyphicon glyphicon-list-alt"></span> Lista de Capas</a></li>
        <li><a role="menuitem" tabindex="5" data-target="#panelLegend" aria-haspopup="true"><span class="glyphicon glyphicon-list"></span> Leyenda</a></li>
        <li><a role="menuitem" tabindex="6" data-target="#panelPrint" aria-haspopup="true"><span class="glyphicon glyphicon-print"></span> Impresion</a></li>



        
        <li><a role="menuitem" tabindex="6" id="calciteToggleNavbar" aria-haspopup="true"><span class="glyphicon glyphicon-fullscreen"></span> Full Map</a></li>
      </ul>
    </div>
    <!-- Title -->
    <div class="calcite-title calcite-overflow-hidden">
      <span class="calcite-title-main">Patrimonio Geológico</span>
      <!-- <span class="calcite-title-divider hidden-xs"></span>
      <span class="calcite-title-sub hidden-xs">Starter app for the ArcGIS API for JS 4.x (dojo)</span>  -->
    </div>
     <!-- Nav -->
    <ul class="calcite-nav nav navbar-nav">                    
      <li><a id="mapNav" class="hidden-xs hidden-sm" href="#mapTab" aria-controls="mapTab" aria-expanded="true" role="tab" data-toggle="tab" data-tooltip="tip" title="2D View" data-placement="bottom">Map</a></li>
      <li class="active"><a id="sceneNav" class="hidden-xs hidden-sm" href="#sceneTab" aria-controls="mapTab" role="tab" data-toggle="tab" data-tooltip="tip" title="3D View" data-placement="bottom">Scene</a></li>                  
      <li>
        <div class="calcite-navbar-search calcite-search-expander" role="presentation" tabindex="-1">
          <div id="searchNavDiv" tabindex="0"></div>
        </div>
      </li>
    </ul>
  </nav><!--/.navbar -->

  <!-- Map Container  -->

  <div class="calcite-map calcite-map-absolute">
    <div id="tabContainer" class="tab-content">
      <div id="mapTab" class="tab-pane fade" role="tabpanel">
         <div id="mapViewDiv"></div>
      </div>
      <div id="sceneTab" class="tab-pane fade in active" role="tabpanel">
        <div id="sceneViewDiv"></div>
      </div>
    </div>
  </div>

  <!-- Panel Container -->

  <div class="calcite-panels calcite-panels-right calcite-bg-custom calcite-text-light calcite-bgcolor-dark-blue panel-group" role="tablist" aria-multiselectable="true">
        
    <!-- Info Panel -->
    
    <div id="panelInfo" class="panel collapse">
      <div id="headingInfo" class="panel-heading" role="tab">
        <div class="panel-title">
          <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseInfo"  aria-expanded="true" aria-controls="collapseInfo"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span><span class="panel-label">Info</span></a> 
          <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelInfo"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>  
        </div>
      </div>
      <div id="collapseInfo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingInfo">
        <div class="panel-body">
         
            descripcion de app
        </div>
     </div>
    </div>

    
    
    <!-- Basemaps Panel -->
    <div id="panelBasemaps" class="panel collapse">
      <div id="headingBasemaps" class="panel-heading" role="tab">
          <div class="panel-title">
              <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseBasemaps" aria-expanded="false" aria-controls="collapseBasemaps">
                  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">Basemaps</span>
              </a>
              <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelBasemaps">
                  <span class="esri-icon esri-icon-close" aria-hidden="true"></span>
              </a>
          </div>
      </div>
      <div id="collapseBasemaps" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingBasemaps">
          <div class="panel-body"><div id="basemapPanelDiv"></div></div>
      </div>
  </div>

  <!-- Bookmarks -->
  <div id="panelBookmarks" class="panel collapse">
      <div id="headingBookmarks" class="panel-heading" role="tab">
          <div class="panel-title">
              <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseBookmarks" aria-expanded="false" aria-controls="collapseBookmarks">
                  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">Bookmarks</span>
              </a>
              <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelBookmarks">
                  <span class="esri-icon esri-icon-close" aria-hidden="true"></span>
              </a>
          </div>
      </div>
      <div id="collapseBookmarks" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingBookmarks">
          <div class="panel-body"><div id="BookmarksPanelDiv"></div></div>
      </div>
  </div>


  <!-- Coordinate Convertion -->
  <div id="panelCoordinateConversion" class="panel collapse">
      <div id="headingCoordinateConversion" class="panel-heading" role="tab">
          <div class="panel-title">
              <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseCoordinateConversion" aria-expanded="false" aria-controls="collapseCoordinateConversion">
                  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">CoordinateConversion</span>
              </a>
              <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelCoordinateConversion">
                  <span class="esri-icon esri-icon-close" aria-hidden="true"></span>
              </a>
          </div>
      </div>
      <div id="collapseCoordinateConversion" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingCoordinateConversion">
          <div class="panel-body"><div id="CoordinateConversionPanelDiv"></div></div>
      </div>
  </div>

  <!-- Listado de Capas-->
  <div id="panelLayerList" class="panel collapse">
      <div id="headingLayerList" class="panel-heading" role="tab">
          <div class="panel-title">
              <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseLayerList" aria-expanded="false" aria-controls="collapseLayerList">
                  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">LayerList</span>
              </a>
              <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelLayerList">
                  <span class="esri-icon esri-icon-close" aria-hidden="true"></span>
              </a>
          </div>
      </div>
      <div id="collapseLayerList" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingLayerList">
          <div class="panel-body"><div id="LayerListPanelDiv"></div></div>
      </div>
  </div>


  <!-- leyenda -->
  <div id="panelLegend" class="panel collapse">
      <div id="headingLegend" class="panel-heading" role="tab">
          <div class="panel-title">
              <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseLegend" aria-expanded="false" aria-controls="collapseLegend">
                  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">Legend</span>
              </a>
              <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelLegend">
                  <span class="esri-icon esri-icon-close" aria-hidden="true"></span>
              </a>
          </div>
      </div>
      <div id="collapseLegend" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingLegend">
          <div class="panel-body"><div id="LegendPanelDiv"></div></div>
      </div>
  </div>


  <!-- Print -->
  <div id="panelPrint" class="panel collapse">
      <div id="headingPrint" class="panel-heading" role="tab">
          <div class="panel-title">
              <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapsePrint" aria-expanded="false" aria-controls="collapsePrint">
                  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">Print</span>
              </a>
              <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelPrint">
                  <span class="esri-icon esri-icon-close" aria-hidden="true"></span>
              </a>
          </div>
      </div>
      <div id="collapsePrint" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingPrint">
          <div class="panel-body"><div id="PrintPanelDiv"></div></div>
      </div>
  </div>

  <!-- Sketch -->
  <!-- <div id="panelSketch" class="panel collapse">
      <div id="headingSketch" class="panel-heading" role="tab">
          <div class="panel-title">
              <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseSketch" aria-expanded="false" aria-controls="collapseSketch">
                  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span><span class="panel-label">Sketch</span>
              </a>
              <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelSketch">
                  <span class="esri-icon esri-icon-close" aria-hidden="true"></span>
              </a>
          </div>
      </div>
      <div id="collapseSketch" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingSketch">
          <div class="panel-body"><div id="SketchPanelDiv"></div></div>
      </div>
  </div> -->



  </div> <!-- /.calcite-panels -->

  <script type="text/javascript">
    var dojoConfig = {
      packages: [{
        name: "bootstrap",
        location: "https://geocatmin.ingemmet.gob.pe/_calcite/dist/vendor/dojo-bootstrap"
      },
      {
        name: "calcite-maps",
        location: "https://geocatmin.ingemmet.gob.pe/_calcite//dist/js/dojo"
      }]
    };
  </script>

  <!-- ArcGIS JS 4 -->
  <script src="https://js.arcgis.com/4.10/"></script>

  <script>

    var app;

    require([
    "esri/WebMap",
    "esri/config",
    "esri/Map",
    "esri/Basemap",
    "esri/views/MapView",
    "esri/views/SceneView",
    "esri/widgets/Search",
    "esri/core/watchUtils",
    "dojo/query",
    "esri/widgets/BasemapGallery",
    "esri/widgets/CoordinateConversion",
    "esri/widgets/Bookmarks",
    "esri/widgets/LayerList",
    "esri/widgets/Legend",
    "esri/widgets/Locate",
    "esri/widgets/Print",
    "esri/widgets/Sketch",
    "esri/layers/GraphicsLayer",
    "esri/geometry/Extent",
    "esri/config",

      // Calcite-maps
      "calcite-maps/calcitemaps-v0.10",
      "calcite-maps/calcitemaps-arcgis-support-v0.10",

      // Bootstrap
      "bootstrap/Collapse", 
      "bootstrap/Dropdown",
      "bootstrap/Tab",      

      "dojo/domReady!"
    ], function(WebMap, esriConfig, Map, Basemap, MapView, SceneView, Search, watchUtils, query, BasemapGallery, CoordinateConversion,
    Bookmarks, LayerList, Legend, Locate, Print, Sketch, GraphicsLayer, Extent,esriConfig,
    CalciteMaps, CalciteMapsArcGIS) {
       
          
    
    
    // App
    app = {
        zoom: 6,
        center: [-74.912469, -9.310016],
        basemap: "hybrid",
        viewPadding: {
            top: 50, bottom: 0
        },
        uiPadding: {
            top: 150, bottom: 15
        },
        map: null,
        mapView: null,
        sceneView: null,
        activeView: null,
        searchWidgetNav: null,
        containerMap: "mapViewDiv",
        containerScene: "sceneViewDiv"
    };

  

    ////esriConfig.portalUrl = "https://geocatmin.ingemmet.gob.pe/portal/"
    //app.map = new WebMap({
    //    portalItem: { id: "f5280ded12814f4da2e4d3647cea54dd" },
    //    ground: "world-elevation"
    //});
    
    //esriConfig.portalUrl = "https://geocatmin.ingemmet.gob.pe/portal"

    // Map 
app.map = new WebMap({
    portalItem: { id: '94bd880808d94a5fb38b5bebb6d572ea'},
        //basemap: app.basemap,
        ground: "world-elevation"
      });

      
    
    //// Map
    //app.map = new Map({
    //    basemap: app.basemap,
    //    ground: "world-elevation"
    //});

    
    // 2D View
    app.mapView = new MapView({
        container: null, // deactivate
        map: app.map,
        zooom: app.zoom,
        center: app.center,
        padding: app.viewPadding,
        ui: {
            components: ["zoom", "compass", "attribution"],
            padding: app.uiPadding
        }
    });

   


    // 3D View
    app.sceneView = new SceneView({
        container: app.containerScene, // activate
        map: app.map,
        zoom: app.zoom,
        center: app.center,
        padding: app.viewPadding,
        ui: {
            padding: app.uiPadding
        }
    });


    // app.sceneView= new Extent({
    //     xmin: -67.965613,
    //     ymin: -18.824816,
    //     xmax: -81.859325,
    //     ymax: 0.204784,
    //     spatialReference: 4326
    // });
    


    // Active view is scene
    setActiveView(app.sceneView);
    //setActiveView(app.mapView);






    // Create search widget
    app.searchWidgetNav = new Search({
        container: "searchNavDiv",
        view: app.activeView
    });

    // Wire-up expand events
    CalciteMapsArcGIS.setSearchExpandEvents(app.searchWidgetNav);
    CalciteMapsArcGIS.setPopupPanelSync(app.mapView);
    CalciteMapsArcGIS.setPopupPanelSync(app.sceneView);

    // Menu UI - change Basemaps
    query("#selectBasemapPanel").on("change", function (e) {
        app.mapView.map.basemap = e.target.options[e.target.selectedIndex].dataset.vector;
        app.sceneView.map.basemap = e.target.value;
    });

    // Tab UI - switch views
    query(".calcite-navbar li a[data-toggle='tab']").on("click", function (e) {
        if (e.target.text.indexOf("Map") > -1) {
            syncViews(app.sceneView, app.mapView);
            setActiveView(app.mapView);
        } else {
            syncViews(app.mapView, app.sceneView);
            setActiveView(app.sceneView);
        }
        syncSearch(app.activeView);
    });

    ////Usuario conectados
    //var userActivity = $.connection.userActivityHub;

    //// Create a function that the hub can call back to display messages.
    //userActivity.client.updateUsersOnlineCount = function (count) {
    //    // Add the message to the page.
    //    $('#spUsuarios').text(count);
    //};


    // Views
    function syncViews(fromView, toView) {
        var viewPt = fromView.viewpoint.clone();
        fromView.container = null;
        if (fromView.type === "3d") {
            toView.container = app.containerMap;
        } else {
            toView.container = app.containerScene;
        }
        toView.viewpoint = viewPt;
        toView.padding = app.viewPadding;
    }

    // Search Widget
    function syncSearch(view) {
        app.searchWidgetNav.view = view;
        if (app.searchWidgetNav.selectedResult) {
            watchUtils.whenTrueOnce(view, "ready", function () {
                app.searchWidgetNav.autoSelect = false;
                app.searchWidgetNav.search(app.searchWidgetNav.selectedResult.name);
                app.searchWidgetNav.autoSelect = true;
            });
        }
    }

    // Active view
    function setActiveView(view) {
        app.activeView = view;
    }


    //Widgets
    var locateBtn = new Locate({
        view: app.activeView
    });

    // Add the locate widget to the top left corner of the view
    app.activeView.ui.add(locateBtn, {
        position: "top-left"
    });
    //Scalebar
    //var scaleBar = new ScaleBar({
    //    view: app.activeView,
    //});

    //app.activeView.ui.add(scaleBar, {
    //    position: "bottom-left"
    //});

    //BasesMaps
    var basemapGallery = new BasemapGallery({
        view: app.activeView,
        container: basemapPanelDiv
    });

    ////BookMark
    //var bookmarks = new Bookmarks({
    //    view: app.activeView,
    //    // allows bookmarks to be added, edited, or deleted
    //    editingEnabled: true,
    //    container: BookmarksPanelDiv
    //});

    //Cordinate Converion
    var ccWidget = new CoordinateConversion({
        view: app.activeView,
        container: CoordinateConversionPanelDiv
    });

    //LayerList
    var layerList = new LayerList({
        view: app.activeView,
        container: LayerListPanelDiv
    });


    ///leyenda
    var legend = new Legend({
        view: app.activeView,
        container: LegendPanelDiv,
        style: "card"
    });

    //Print
    var print = new Print({
        view: app.activeView,
        container: PrintPanelDiv
    });
    //Sketch
    //const sketch = new Sketch({
    //    view: app.activeView,
    //    container: SketchPanelDiv
    //});
    //// Add the widget to the top-right corner of the view
    //app.activeView.ui.add(basemapGallery, {
    //    position: "top-right"
    //});
    });

  </script>

</body>
</html>

